import base64

def KSA(key):
    """ Key-Scheduling Algorithm (KSA) 密钥调度算法"""
    S = list(range(256))
    j = 0
    for i in range(256):
        j = (j + S[i] + key[i % len(key)]) % 256
        S[i], S[j] = S[j], S[i]
    return S


def PRGA(S):
    """ Pseudo-Random Generation Algorithm (PRGA) 伪随机数生成算法"""
    i, j = 0, 0
    while True:
        i = (i + 1) % 256
        j = (j + S[i]) % 256
        S[i], S[j] = S[j], S[i]
        K = S[(S[i] + S[j]) % 256]
        yield K


def RC4(key, text):
    """ RC4 encryption/decryption """
    S = KSA(key)
    keystream = PRGA(S)
    res = []
    for char in text:
        res.append(char ^ next(keystream))
    return bytes(res)


if __name__ == "__main__":
    key = b'dkjg76nck0'
    print(base64.b64encode(RC4(key, b"aaaaaaaaaaaaa")[:20]))
    text = base64.b64decode(b'RwZqI4gWbPH/C9b5/cCGLkIupTI=')
    print(text)
    print(RC4(key, text))
    print(RC4(key, text).decode())

    d = [0x00000000, 0x00000007, 0x00000101, 0x00000003, 0x00004501, 0x00000801, 0x0000000A, 0x00017001, 0x00000009, 0x00000002, 0x00000002, 0x00000002, 0x00000007, 0x00000201, 0x00000003, 0x00004301, 0x00001301, 0x0000000A, 0x00017001, 0x00000009, 0x00000002, 0x00000002, 0x00000002, 0x00000007, 0x00000301, 0x00000003, 0x00005601, 0x00001E01, 0x0000000A, 0x00017001, 0x00000009, 0x00000002, 0x00000002, 0x00000002, 0x00000007, 0x00000101, 0x00000003, 0x00004401, 0x00002901, 0x0000000A, 0x00017001, 0x00000009, 0x00000002, 0x00000002, 0x00000002, 0x00000007, 0x00000201, 0x00000003, 0x00005601, 0x00003401, 0x0000000A, 0x00017001, 0x00000009, 0x00000002, 0x00000002, 0x00000002, 0x00000007, 0x00000301, 0x00000003, 0x00004901, 0x00003F01, 0x0000000A, 0x00017001, 0x00000009, 0x00000002, 0x00000002, 0x00000002, 0x00000007, 0x00000805, 0x00000101, 0x00000004, 0x007B0101, 0x00004B01, 0x0000000A, 0x00017001, 0x00000009, 0x00000002, 0x00000002, 0x00000002, 0x00000007, 0x00000805, 0x00000201, 0x00000004, 0x00680201, 0x00005701, 0x0000000A, 0x00017001, 0x00000009, 0x00000002, 0x00000002, 0x00000002, 0x00000007, 0x00000805, 0x00000301, 0x00000004, 0x00310301, 0x00006301, 0x0000000A, 0x00017001, 0x00000009, 0x00000002, 0x00000002, 0x00000002, 0x00000007, 0x00000805, 0x00000101, 0x00000004, 0x00440101, 0x00006F01, 0x0000000A, 0x00017001, 0x00000009, 0x00000002, 0x00000002, 0x00000002, 0x00000007, 0x00000805, 0x00000101, 0x00000004, 0x00650101, 0x00007B01, 0x0000000A, 0x00017001, 0x00000009, 0x00000002, 0x00000002, 0x00000002, 0x00000007, 0x00000805, 0x00000201, 0x00000004, 0x006E0201, 0x00008701, 0x0000000A, 0x00017001, 0x00000009, 0x00000002, 0x00000002, 0x00000002, 0x00000007, 0x00000805, 0x00000301, 0x00000004, 0x005F0301, 0x00009301, 0x0000000A, 0x00017001, 0x00000009, 0x00000002, 0x00000002, 0x00000002, 0x00000007, 0x00000101, 0x00000003, 0x00005701, 0x00009E01, 0x0000000A, 0x00017001, 0x00000009, 0x00000002, 0x00000002, 0x00000002, 0x00000007, 0x00000201, 0x00000003, 0x00006F01, 0x0000A901, 0x0000000A, 0x00017001, 0x00000009, 0x00000002, 0x00000002, 0x00000002, 0x00000007, 0x00000301, 0x00000003, 0x00006201, 0x0000B401, 0x0000000A, 0x00017001, 0x00000009, 0x00000002, 0x00000002, 0x00000002, 0x00000007, 0x00000101, 0x00000003, 0x00004A01, 0x0000BF01, 0x0000000A, 0x00017001, 0x00000009, 0x00000002, 0x00000002, 0x00000002, 0x00000007, 0x00000201, 0x00000003, 0x00003501, 0x0000CA01, 0x0000000A, 0x00017001, 0x00000009, 0x00000002, 0x00000002, 0x00000002, 0x00000007, 0x00000301, 0x00000003, 0x00006201, 0x0000D501, 0x0000000A, 0x00017001, 0x00000009, 0x00000002, 0x00000002, 0x00000002, 0x00000007, 0x00000201, 0x00000003, 0x00005501, 0x0000E001, 0x0000000A, 0x00017001, 0x00000009, 0x00000002, 0x00000002, 0x00000002, 0x00000007, 0x00000105, 0x0000DE01, 0x0000EA01, 0x0000000A, 0x00017001, 0x00000009, 0x00000002, 0x00000002, 0x00000002, 0x00000007, 0x00000205, 0x0001BC01, 0x0000F401, 0x0000000A, 0x00017001, 0x00000009, 0x00000002, 0x00000002, 0x00000002, 0x00000007, 0x00000305, 0x00018001, 0x0000FE01, 0x0000000A, 0x00017001, 0x00000009, 0x00000002, 0x00000002, 0x00000002, 0x00000007, 0x00000805, 0x00000101, 0x00000004, 0x005F0101, 0x00010A01, 0x0000000A, 0x00017001, 0x00000009, 0x00000002, 0x00000002, 0x00000002, 0x00000007, 0x00000805, 0x00000201, 0x00000004, 0x00460201, 0x00011601, 0x0000000A, 0x00017001, 0x00000009, 0x00000002, 0x00000002, 0x00000002, 0x00000007, 0x00000805, 0x00000301, 0x00000004, 0x00750301, 0x00012201, 0x0000000A, 0x00017001, 0x00000009, 0x00000002, 0x00000002, 0x00000002, 0x00000007, 0x00000105, 0x0000DC01, 0x00012C01, 0x0000000A, 0x00017001, 0x00000009, 0x00000002, 0x00000002, 0x00000002, 0x00000007, 0x00000205, 0x00017C01, 0x00013601, 0x0000000A, 0x00017001, 0x00000009, 0x00000002, 0x00000002, 0x00000002, 0x00000007, 0x00000305, 0x00010801, 0x00014001, 0x0000000A, 0x00017001, 0x00000009, 0x00000002, 0x00000002, 0x00000002, 0x00000007, 0x00000305, 0x0003E801, 0x00014A01, 0x0000000A, 0x00017001, 0x00000009, 0x00000002, 0x00000002, 0x00000002, 0x00004301, 0x00000008, 0x00006F01, 0x00000008, 0x00006E01, 0x00000008, 0x00006701, 0x00000008, 0x00007201, 0x00000008, 0x00006101, 0x00000008, 0x00007401, 0x00000008, 0x00007501, 0x00000008, 0x00006C01, 0x00000008, 0x00006101, 0x00000008, 0x00007401, 0x00000008, 0x00006901, 0x00000008, 0x00006F01, 0x00000008, 0x00006E01, 0x00000008, 0x00007301, 0x00000008, 0x00002101, 0x00000008, 0x00000A01, 0x00000008, 0x0000000C, 0x00005401, 0x00000008, 0x00007201, 0x00000008, 0x00007901, 0x00000008, 0x00002C01, 0x00000008, 0x00004101, 0x00000008, 0x00006701, 0x00000008, 0x00006101, 0x00000008, 0x00006901, 0x00000008, 0x00006E01, 0x00000008, 0x00002101, 0x00000008, 0x00000A01, 0x00000008, 0x0000000C, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000]

